<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Live Crypto Prices (Coinbase)</title>
  <style>
    body { background:#0f172a; color:#f1f5f9; font-family:Arial; text-align:center; margin-top:60px;}
    .price{ font-size:2.5em; margin:20px;}
    .change{ font-size:1.2em; margin-bottom:20px;}
    .status{ font-size:0.9em; color:#94a3b8;}
  </style>
</head>
<body>
  <h1>Live Crypto Prices (Coinbase)</h1>
  <div class="price" id="btc">BTC: —</div>
  <div class="change" id="btc-change">24h: —</div>
  <div class="price" id="doge">DOGE: —</div>
  <div class="change" id="doge-change">24h: —</div>
  <div class="status" id="status">Connecting...</div>

  <script>
    const URL = 'wss://ws-feed.pro.coinbase.com';
    let ws = null, timer = null;

    function connect() {
      ws = new WebSocket(URL);
      status('Подключение...');

      ws.onopen = () => {
        status('Подключено');
        ws.send(JSON.stringify({
          type: "subscribe",
          channels: [{ name: "ticker", product_ids: ["BTC-USD","DOGE-USD"] }]
        }));
      };

      ws.onmessage = e => {
        const msg = JSON.parse(e.data);
        if (msg.type !== 'ticker') return;

        const sym = msg.product_id.split('-')[0];
        const price = parseFloat(msg.price);
        const open = parseFloat(msg.open_24h);
        const change = ((price - open) / open * 100).toFixed(2);

        document.getElementById(sym.toLowerCase()).textContent =
          `${sym}: $${price.toFixed(sym==="BTC"?2:4)}`;

        const el = document.getElementById(sym.toLowerCase() + '-change');
        el.textContent = `24h: ${change}%`;
        el.style.color = price >= open ? '#10b981' : '#ef4444';

        const time = new Date(msg.time).toLocaleTimeString();
        status(`Обновлено: ${time}`);
      };

      ws.onerror = () => {
        status('Ошибка WebSocket');
        ws.close();
      };

      ws.onclose = () => {
        status('Потеряно соединение… Переподключение через 5 сек.');
        clearTimeout(timer);
        timer = setTimeout(connect, 5000);
      };
    }

    function status(text) {
      document.getElementById('status').textContent = text;
    }

    connect();
  </script>
</body>
</html>
